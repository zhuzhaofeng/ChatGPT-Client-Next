System.register(["./.pnpm-legacy-1529022a.js","./index-legacy-9755b386.js"],(function(t,e){"use strict";var a,r,n,o,i,s,l,c,m,p,d,u,w,x,b,g,f,v,y,k,h,_,C,z,T,$,E,S,Y,j,R,X,q,H,Z,A,B,L,M,K,V,U,D,W,F,G,I,J,N,O=document.createElement("style");return O.textContent=".message-content[data-v-cf02b953]{max-width:-webkit-max-content!important;max-width:-moz-max-content!important;max-width:max-content!important}.chat-wrapper{display:-webkit-box!important;display:-ms-flexbox!important;display:-webkit-flex!important;display:flex!important;-webkit-box-orient:vertical!important;-webkit-box-direction:normal!important;-ms-flex-direction:column!important;-webkit-flex-direction:column!important;flex-direction:column!important;-webkit-box-flex:1!important;-ms-flex:1 1 0%!important;-webkit-flex:1 1 0%!important;flex:1 1 0%!important;height:100%!important;overflow:hidden!important}.chat-wrapper .message-item{display:-webkit-box!important;display:-ms-flexbox!important;display:-webkit-flex!important;display:flex!important;-webkit-box-orient:vertical!important;-webkit-box-direction:normal!important;-ms-flex-direction:column!important;-webkit-flex-direction:column!important;flex-direction:column!important;-webkit-box-align:start!important;-ms-flex-align:start!important;-webkit-align-items:flex-start!important;align-items:flex-start!important;justify-items:start!important;padding-left:0!important;grid-gap:.5rem!important;gap:.5rem!important}.chat-wrapper .message-item.is-request{-webkit-box-align:end!important;-ms-flex-align:end!important;-webkit-align-items:flex-end!important;align-items:flex-end!important;margin-left:auto!important;max-width:-webkit-max-content!important;max-width:-moz-max-content!important;max-width:max-content!important;padding-left:2.5rem!important}.chat-wrapper .message-item .message-item__content{border-radius:.5rem!important;display:-webkit-box!important;display:-ms-flexbox!important;display:-webkit-flex!important;display:flex!important;-webkit-box-orient:vertical!important;-webkit-box-direction:normal!important;-ms-flex-direction:column!important;-webkit-flex-direction:column!important;flex-direction:column!important;font-size:.875rem!important;line-height:1.25rem!important;max-width:100%!important;min-width:18rem!important;padding:.75rem 1rem!important;position:relative!important}.chat-wrapper .message-item .message-item__content.is-user{--tw-bg-opacity: 1 !important;background-color:rgba(16,163,127,var(--tw-bg-opacity))!important;-webkit-box-pack:end!important;-ms-flex-pack:end!important;-webkit-justify-content:flex-end!important;justify-content:flex-end!important;--tw-text-opacity: 1 !important;color:rgba(255,255,255,var(--tw-text-opacity))!important}.chat-wrapper .message-item .message-item__content.is-assistant{--tw-bg-opacity: 1 !important;background-color:rgba(255,255,255,var(--tw-bg-opacity))!important}.dark .chat-wrapper .message-item .message-item__content.is-assistant{--tw-bg-opacity: 1 !important;background-color:rgba(35,35,36,var(--tw-bg-opacity))!important}.chat-wrapper .message-item .message-item__actions{display:-webkit-box!important;display:-ms-flexbox!important;display:-webkit-flex!important;display:flex!important;-webkit-box-align:center!important;-ms-flex-align:center!important;-webkit-align-items:center!important;align-items:center!important;opacity:0!important;padding-left:1rem!important;position:absolute!important;top:-2.25rem!important;right:2rem!important;-webkit-column-gap:.25rem!important;-moz-column-gap:.25rem!important;grid-column-gap:.25rem!important;column-gap:.25rem!important;-webkit-transition-property:all!important;-o-transition-property:all!important;transition-property:all!important;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1)!important;-o-transition-timing-function:cubic-bezier(.4,0,.2,1)!important;transition-timing-function:cubic-bezier(.4,0,.2,1)!important;-webkit-transition-duration:.15s!important;-o-transition-duration:.15s!important;transition-duration:.15s!important;-webkit-transition-duration:.5s!important;-o-transition-duration:.5s!important;transition-duration:.5s!important}.chat-wrapper .message-item:hover .message-item__actions{opacity:1!important;right:0px!important}.chat-footer{--tw-bg-opacity: 1 !important;background-color:rgba(255,255,255,var(--tw-bg-opacity))!important;display:-webkit-box!important;display:-ms-flexbox!important;display:-webkit-flex!important;display:flex!important;-webkit-box-align:end!important;-ms-flex-align:end!important;-webkit-align-items:flex-end!important;align-items:flex-end!important;-webkit-box-pack:end!important;-ms-flex-pack:end!important;-webkit-justify-content:flex-end!important;justify-content:flex-end!important;padding:.75rem 1rem .5rem .5rem!important;position:relative!important;width:100%!important}.dark .chat-footer{--tw-bg-opacity: 1 !important;background-color:rgba(23,23,26,var(--tw-bg-opacity))!important}.chat-footer .stop-receiving{position:absolute!important;top:-3rem!important;left:50%!important;--tw-translate-x: 0 !important;--tw-translate-y: 0 !important;--tw-translate-z: 0 !important;--tw-rotate: 0 !important;--tw-rotate-x: 0 !important;--tw-rotate-y: 0 !important;--tw-rotate-z: 0 !important;--tw-skew-x: 0 !important;--tw-skew-y: 0 !important;--tw-scale-x: 1 !important;--tw-scale-y: 1 !important;--tw-scale-z: 1 !important;-webkit-transform:translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) translateZ(var(--tw-translate-z)) rotate(var(--tw-rotate)) rotateX(var(--tw-rotate-x)) rotateY(var(--tw-rotate-y)) rotateZ(var(--tw-rotate-z)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)) scaleZ(var(--tw-scale-z))!important;-ms-transform:translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) translateZ(var(--tw-translate-z)) rotate(var(--tw-rotate)) rotateX(var(--tw-rotate-x)) rotateY(var(--tw-rotate-y)) rotateZ(var(--tw-rotate-z)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)) scaleZ(var(--tw-scale-z))!important;transform:translate(var(--tw-translate-x)) translateY(var(--tw-translate-y)) translateZ(var(--tw-translate-z)) rotate(var(--tw-rotate)) rotateX(var(--tw-rotate-x)) rotateY(var(--tw-rotate-y)) rotate(var(--tw-rotate-z)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)) scaleZ(var(--tw-scale-z))!important;--tw-translate-x: -50% !important}.date-time{color:rgb(var(--gray-8))}\n",document.head.appendChild(O),{setters:[t=>{a=t.c,r=t.r,n=t.ag,o=t.ah,i=t.ai,s=t.aj,l=t.e,c=t.ak,m=t.al,p=t.g,d=t.l,u=t.u,w=t.t,x=t.n,b=t.f,g=t.j,f=t.i,v=t.k,y=t.v,k=t.F,h=t.am,_=t.M,C=t.B,z=t.W,T=t.o,$=t.b,E=t.w,S=t.a,Y=t.an,j=t.m,R=t.J,X=t.h,q=t.y,H=t.ao,Z=t.a5,A=t.K,B=t.N,L=t.ap,M=t.aq,K=t.ar,V=t.as,U=t.S,D=t.T},t=>{W=t._,F=t.u,G=t.b,I=t.c,J=t.d,N=t.S}],execute:function(){const e={key:0,class:"dark:text-white w-[4px] h-[20px] block animate-blink"},O={key:0},P=["innerHTML"],Q=["textContent"],tt=["textContent"],et=a({__name:"MessageContent",props:{inversion:{type:Boolean},error:{type:Boolean},text:null,loading:{type:Boolean},asRawText:{type:Boolean}},setup(t){const a=t,b=r(),g=new n({linkify:!0,highlight(t,e){if(e&&o.getLanguage(e)){const a=e??"";return y(o.highlight(t,{language:a}).value,a)}return y(o.highlightAuto(t).value,"")}});g.use(i,{attrs:{target:"_blank",rel:"noopener"}}),g.use(s,{blockClass:"katexmath-block rounded-md p-[10px]",errorColor:" #cc0000"});const f=l((()=>["message-content","min-w-[20px]","rounded-md",a.inversion?"text-[#f1f1f1]":"bg-[#e5e6eb]",a.inversion?"text-[]":"dark:bg-[#1e1e20]",a.inversion?"message-request":"message-reply",{"text-red-500":a.error}])),v=l((()=>{const t=(a.text??"").replace(/\n+$/g,"");return a.asRawText||a.inversion?t:g.render(t)}));function y(t,e){return`<pre class="code-block-wrapper"><div class="code-block-header"><span class="code-block-header__lang">${e}</span><span class="code-block-header__copy">复制代码</span></div><code class="hljs code-block-body ${e}">${t}</code></pre>`}return c((()=>{m((()=>{b.value&&o.highlightBlock(b.value)}))})),(a,r)=>(p(),d("div",{class:x(u(f))},[t.loading?(p(),d("span",e)):(p(),d("div",{key:1,ref_key:"textRef",ref:b,class:"leading-relaxed break-words"},[t.inversion?(p(),d("div",{key:1,class:"whitespace-pre-wrap",textContent:w(u(v))},null,8,tt)):(p(),d("div",O,[t.asRawText?(p(),d("div",{key:1,class:"whitespace-pre-wrap",textContent:w(u(v))},null,8,Q)):(p(),d("div",{key:0,class:"markdown-body",innerHTML:u(v)},null,8,P))]))],512))],2))}}),at=W(et,[["__scopeId","data-v-cf02b953"]]);function rt(t){const e={origin:!0,...t};let a;a=e.origin?document.createElement("textarea"):document.createElement("input"),a.setAttribute("readonly","readonly"),a.value=e.text,document.body.appendChild(a),a.select(),document.execCommand("copy")&&document.execCommand("copy"),document.body.removeChild(a)}const nt={class:"break-words break-all whitespace-pre-wrap"},ot=a({__name:"DownloadSession",setup(t){const e=r(!1),a=F(),n=l((()=>`导出聊天: ${a.session?.topic||""}`)),o=l((()=>{const{session:t}=a,e=(t?.messages??[]).map((({content:t,role:e})=>`\n## 来自${"user"===e?"您":"GPT"}的消息: \n${t}`));return t?.topic&&e.unshift(`# ${t.topic}`),e.join("\n")})),i=()=>{const{session:t}=a;let e=new Blob([o.value],{type:"text/plain;charset=utf-8"});h.saveAs(e,t?.topic?`${t.topic}.md`:"新的聊天.md")},s=()=>{rt({text:o.value}),_.clear(),_.success("复制成功")};return(t,a)=>{const r=b("icon-share-external"),l=C,c=at,m=z;return p(),d(k,null,[g(l,{onClick:a[0]||(a[0]=t=>e.value=!0),size:"small",type:"text"},{default:f((()=>[g(r)])),_:1}),g(m,{visible:u(e),"onUpdate:visible":a[1]||(a[1]=t=>y(e)?e.value=t:null),width:"90%",title:u(n),class:"message-drawer","cancel-text":"复制文本","ok-text":"导出文件(.md)","drawer-style":{maxWidth:"500px"},onOk:i,onCancel:s},{default:f((()=>[v("div",nt,[g(c,{"as-raw-text":"",class:"p-3 bg-[#fafafa] w-full hljs",text:u(o)},null,8,["text"])])])),_:1},8,["visible","title"])],64)}}});function it(){function t(){document.querySelectorAll(".code-block-wrapper").forEach((t=>{const e=t.querySelector(".code-block-header__copy"),a=t.querySelector(".code-block-body");e&&a&&e.addEventListener("click",(()=>{navigator.clipboard?.writeText?(navigator.clipboard.writeText(a.textContent??""),_.clear(),_.success("复制成功")):(rt({text:a.textContent??"",origin:!0}),_.clear(),_.success("复制成功"))}))}))}t(),T((()=>t())),c((()=>t()))}const st={key:0,class:"flex-1"},lt={class:"chat-wrapper"},ct=["src"],mt={class:"date-time"},pt={key:0,class:"text-info"},dt={key:0,class:"message-item__actions"},ut={class:"chat-footer"};t("default",a({__name:"ChatView",setup(t){it();const e=F(),a=G(),n=l((()=>e.session)),{isMobileScreen:o}=I(),i=r(!1),s={user:J,assistant:"/static/svg/openai-white-1b79b841.svg"},c=r(),h=r("新的聊天");$((()=>{h.value=e.session?.topic||"新的聊天"})),E((()=>e.currentChat),(()=>{m((()=>{c.value?.scrollTop((c.value?.containerRef?.scrollHeight??0)-200)}))}));const z=r(""),W=()=>{if(t=z.value,/^[\s\n\r]*$/.test(t))return _.clear(),void _.error("请输入消息内容");var t;i.value=!1,e.sendMessageAction(z.value,(t=>{i.value||c.value?.scrollTop((c.value?.containerRef?.scrollHeight??0)-200),t&&m((()=>{it()}))})),z.value=""},O=t=>{t.deltaY<10&&(i.value=!0)};T((()=>{m((()=>{c.value?.scrollTop((c.value?.containerRef?.scrollHeight??0)-200),c.value?.$el.querySelector(".arco-scrollbar-container").addEventListener("wheel",O)}))}));const P=t=>{(t?.target?.scrollTop||0)+(t?.target?.offsetHeight||0)>=(t?.target?.scrollHeight||0)-70&&(i.value=!1)};S((()=>{e.abortController?.abort&&e.abortController?.abort(),c.value?.$el.querySelector(".arco-scrollbar-container").removeEventListener("wheel",O)}));const Q=()=>{e.handleChangeSessionTopicAction(h.value)},tt=t=>{o.value||"Enter"!==t.key||t.shiftKey||(t.preventDefault(),W())},et=l((()=>{let t="请输入您的消息";return o.value||(t+=`，${a.submitKey} 发送，${a.submitKey===N.Enter?N.ShiftEnter:N.Enter} 换行`),t}));return(t,a)=>{const r=H,l=ot,m=Z,T=A,$=V,E=U,S=b("icon-copy"),F=C,G=D,I=b("icon-sync"),J=at,N=B,O=b("icon-record-stop"),nt=L,it=M,wt=Y("date-time");return p(),d(k,null,[g(m,{class:"h-14 px-4 flex items-center gap-x-3 bg-white dark:bg-dark"},{default:f((()=>[v("div",{class:x(["flex flex-col editable-title__wrapper",{"is-mobile":u(o)}])},[g(r,{class:"m-0",editable:"",editText:u(h),"onUpdate:editText":a[0]||(a[0]=t=>y(h)?h.value=t:null),onEditEnd:Q},{default:f((()=>[j(w(u(h)),1)])),_:1},8,["editText"])],2),u(o)?R("",!0):(p(),d("i",st)),u(n)?.messages?.length?(p(),X(l,{key:1})):R("",!0)])),_:1}),g(T,{class:"m-0"}),g(it,{class:"flex flex-col flex-1 overflow-hidden"},{default:f((()=>[v("main",lt,[g(N,{ref_key:"scrollbarRef",ref:c,onScroll:P,"outer-style":"flex: 1; overflow: hidden; ",class:"overflow-y-auto h-full p-4 flex flex-col gap-y-2 pb-20"},{default:f((()=>[(p(!0),d(k,null,q(u(n)?.messages??[],((t,a)=>(p(),d("section",{key:t.id,class:x(["message-item",["assistant"===t.role?"is-reply":"is-request",u(o)?"max-w-full":"max-w-4/5"]])},[v("div",{class:x(["flex items-center gap-x-4",{"flex-row-reverse":"assistant"!==t.role}])},[g(E,{loading:t.streaming&&"assistant"===t.role},{default:f((()=>[g($,{size:32,class:x("assistant"===t.role?"bg-primary p-2":"bg-success")},{default:f((()=>[v("img",{src:s[t.role]??""},null,8,ct)])),_:2},1032,["class"])])),_:2},1032,["loading"]),K((p(),d("small",mt,[j(w(t.date),1)])),[[wt,t.date]])],2),t.streaming&&"assistant"===t.role?(p(),d("small",pt," 正在输入... ")):R("",!0),v("section",{class:x(["message-item__content",{"is-user":"user"===t.role},{"is-assistant":"assistant"===t.role}])},["assistant"===t.role?(p(),d("div",dt,[g(G,{"content-class":"text-xs",content:"复制",position:"top"},{default:f((()=>[g(F,{onClick:e=>(rt({text:t.content}),_.clear(),void _.success("复制成功")),size:"mini",shape:"circle",type:"text"},{default:f((()=>[g(S,{class:"text-base"})])),_:2},1032,["onClick"])])),_:2},1024),g(G,{"content-class":"text-xs",content:"重试",position:"top"},{default:f((()=>[g(F,{onClick:t=>(t=>{i.value=!1,e.messageRetryAction(t,(()=>{i.value||c.value?.scrollTop((c.value?.containerRef?.scrollHeight??0)-200)}))})(a),size:"mini",shape:"circle",type:"text"},{default:f((()=>[g(I,{class:"text-base"})])),_:2},1032,["onClick"])])),_:2},1024)])):R("",!0),(p(),X(J,{key:t.content,text:t.content,inversion:"assistant"!==t.role},null,8,["text","inversion"]))],2)],2)))),128))])),_:1},512),g(T,{class:"m-0"}),v("footer",ut,[u(e).fetching?(p(),X(F,{key:0,onClick:a[1]||(a[1]=t=>u(e).abortController?.abort()),shape:"round",status:"danger",class:"stop-receiving"},{default:f((()=>[g(O,{class:"text-lg mr-2"}),j(" 停止 ")])),_:1})):R("",!0),g(nt,{modelValue:u(z),"onUpdate:modelValue":a[2]||(a[2]=t=>y(z)?z.value=t:null),onKeypress:tt,class:"bg-white dark:bg-dark-900 border-none","auto-size":{minRows:u(o)?1:3,maxRows:6},placeholder:u(et)},null,8,["modelValue","auto-size","placeholder"]),u(o)&&u(z).trim().length>0?(p(),X(F,{key:1,size:"medium",class:"rounded text-xs",onClick:W,type:"primary"},{default:f((()=>[j(" 发送 ")])),_:1})):R("",!0)])])])),_:1})],64)}}}))}}}));
