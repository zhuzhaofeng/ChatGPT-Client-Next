import{d as r,r as o,o as a,l as s}from"./.pnpm-40c6151e.js";import{b as t,I as e}from"./index-fa67857c.js";const n=r("__AI_1024_STORE_DRAW",(()=>{const r=t(),n=o(!1),l=o([]);a((()=>{}));return{draws:l,loading:n,imageDrawAction:o=>{n.value=!0,async function(r,o){const a=new AbortController,s=setTimeout((()=>a.abort()),3e5);try{const n=`${t().bootstrap.api}${e}`,l=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),signal:a.signal});if(clearTimeout(s),l.ok){const r=await l.json();500===r.code?null==o||o.onError(new Error(r.msg),r.code):null==o||o.onSuccess(r)}else if(401===l.status)null==o||o.onError(new Error("Anauthorized"),l.status);else if(500===l.status){const r=await l.json();null==o||o.onError(new Error(r),l.status)}else null==o||o.onError(new Error("Stream Error"),l.status)}catch(n){null==o||o.onError(n)}}({...o,card:r.card},{onController(r){},onSuccess(r){n.value=!1,l.value.push({prompt:o.prompt,size:o.size,urls:r.data.map((r=>`data:image/png;base64, ${r.b64_json}`)),date:r.created})},onError(r){var o;n.value=!1,s.error(null!=(o=null==r?void 0:r.message)?o:"")}})}}}),{persist:{storage:localStorage,paths:["draws"]}});export{n as u};
