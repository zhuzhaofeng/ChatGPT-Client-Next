import{c as e,r as l,ak as a,al as s,am as t,an as n,m as o,aq as r,ar as i,e as c,p as u,F as d,j as v,t as p,u as g,J as m,o as x,l as y,b as f,w as h,a as b,n as k,as as w,f as _,g as C,h as E,i as R,x as T,H as S,k as H,B as $,V as q,D as z,at as B,au as L,av as j,aw as A,S as M,z as V,ax as K,ay as Q}from"./.pnpm-75a79e04.js";import{a as D,u as F,d as I,e as J,f as U,S as W,b as Y,c as G}from"./index-f05af14f.js";const N={key:0,class:"dark:text-white w-[4px] h-[20px] block animate-blink"},O={key:0},P=["innerHTML"],X=["textContent"],Z=["textContent"],ee=D(e({__name:"MessageContent",props:{inversion:{type:Boolean},error:{type:Boolean},text:null,loading:{type:Boolean},asRawText:{type:Boolean}},setup(e){const x=e,y=l(),f=new a({linkify:!0,highlight(e,l){if(!(!l||!s.getLanguage(l))){const a=null!=l?l:"";return k(s.highlight(e,{language:a}).value,a)}return k(s.highlightAuto(e).value,"")}});f.use(t,{attrs:{target:"_blank",rel:"noopener"}}),f.use(n,{blockClass:"katexmath-block rounded-md p-[10px]"});const h=o((()=>["message-content","min-w-[20px]","rounded-md",x.inversion?"text-[#f1f1f1]":"bg-[#e5e6eb]",x.inversion?"":"dark:bg-[#1e1e20]",x.inversion?"message-request":"message-reply",{"is-error":x.error}])),b=o((()=>{var e;const l=(null!=(e=x.text)?e:"").replace(/\n+$/g,"");return x.asRawText||x.inversion?l:f.render(l)}));function k(e,l){return`<pre class="code-block-wrapper"><div class="code-block-header"><span class="code-block-header__lang">${l}</span><span class="code-block-header__copy">复制代码</span></div><code class="hljs code-block-body ${l}">${e}</code></pre>`}return r((()=>{i((()=>{y.value&&s.highlightBlock(y.value)}))})),(l,a)=>(c(),u("div",{class:m(g(h))},[e.loading?(c(),u("span",N)):(c(),u("div",{key:1,ref_key:"textRef",ref:y,class:"leading-relaxed break-words"},[e.inversion?(c(),u("div",{key:1,class:"whitespace-pre-wrap",textContent:p(e.text)},null,8,Z)):(c(),u("div",O,[e.error?(c(),u(d,{key:0},[v(p(e.text),1)],64)):(c(),u(d,{key:1},[e.asRawText?(c(),u("div",{key:1,class:"whitespace-pre-wrap",textContent:p(e.text)},null,8,X)):(c(),u("div",{key:0,class:"markdown-body",innerHTML:g(b)},null,8,P))],64))]))],512))],2))}}),[["__scopeId","data-v-d42c4383"]]);function le(e){const l={origin:!0,...e};let a;a=l.origin?document.createElement("textarea"):document.createElement("input"),a.setAttribute("readonly","readonly"),a.value=l.text,document.body.appendChild(a),a.select(),document.execCommand("copy")&&document.execCommand("copy"),document.body.removeChild(a)}function ae(){function e(){document.querySelectorAll(".code-block-wrapper").forEach((e=>{const l=e.querySelector(".code-block-header__copy"),a=e.querySelector(".code-block-body");l&&a&&l.addEventListener("click",(()=>{var e,l,s;(null==(e=navigator.clipboard)?void 0:e.writeText)?(navigator.clipboard.writeText(null!=(l=a.textContent)?l:""),y.clear(),y.success("复制成功")):(le({text:null!=(s=a.textContent)?s:"",origin:!0}),y.clear(),y.success("复制成功"))}))}))}e(),x((()=>e())),r((()=>e()))}const se={class:"chat-wrapper"},te={key:0,class:"flex flex-col items-center justify-center mt-10 gap-y-10 text-center text-gray-600"},ne=[E("span",null," 国内最快最好用的gpt站点，网址经常变更，所以使用前一定要记得先加群！！！ ",-1),E("div",{class:"grid grid-cols-2"},[E("div",{class:"flex flex-col items-center gap-y-2 py-2"},[E("img",{class:"max-w-40 w-11/12 border-solid border border-gray-200 p-1",alt:"QQ",src:Y}),E("span",{class:""},"QQ群")]),E("div",{class:"flex flex-col items-center gap-y-2 py-2"},[E("img",{class:"max-w-40 w-11/12 border-solid border border-gray-200 p-1",alt:"WeChat",src:G}),E("span",{class:""},"微信群")])],-1)],oe=["src"],re={class:"date-time"},ie={key:0,class:"text-info"},ce={key:0,class:"message-item__actions"},ue={key:1,class:"flex items-center gap-x-2"},de={key:0,class:"chat-footer"},ve=e({__name:"ChatView",setup(e){ae();const a=F(),s=I(),t=o((()=>a.session)),{isMobileScreen:n}=J(),r=l(!1),D={user:U,assistant:"/static/svg/openai-white-1b79b841.svg"},Y=l(),G=l("新的聊天");f((()=>{var e;G.value=(null==(e=a.session)?void 0:e.topic)||"新的聊天"})),h((()=>a.currentChat),(()=>{i((()=>{var e,l,a,s;null==(s=Y.value)||s.scrollTop((null!=(a=null==(l=null==(e=Y.value)?void 0:e.containerRef)?void 0:l.scrollHeight)?a:0)-200)}))}));const N=l(""),O=()=>{if(e=N.value,/^[\s\n\r]*$/.test(e))return y.clear(),void y.error("请输入消息内容");var e;r.value=!1,a.sendMessageAction(N.value,(e=>{var l,a,s,t;r.value||null==(t=Y.value)||t.scrollTop((null!=(s=null==(a=null==(l=Y.value)?void 0:l.containerRef)?void 0:a.scrollHeight)?s:0)-200),e&&i((()=>{ae()}))})),N.value=""},P=e=>{e.deltaY<10&&(r.value=!0)};x((()=>{i((()=>{var e,l,a,s,t;null==(s=Y.value)||s.scrollTop((null!=(a=null==(l=null==(e=Y.value)?void 0:e.containerRef)?void 0:l.scrollHeight)?a:0)-200),null==(t=Y.value)||t.$el.querySelector(".arco-scrollbar-container").addEventListener("wheel",P)}))}));const X=e=>{var l,a,s;((null==(l=null==e?void 0:e.target)?void 0:l.scrollTop)||0)+((null==(a=null==e?void 0:e.target)?void 0:a.offsetHeight)||0)>=((null==(s=null==e?void 0:e.target)?void 0:s.scrollHeight)||0)-70&&(r.value=!1)};b((()=>{var e,l,s;(null==(e=a.abortController)?void 0:e.abort)&&(null==(l=a.abortController)||l.abort()),null==(s=Y.value)||s.$el.querySelector(".arco-scrollbar-container").removeEventListener("wheel",P)}));const Z=e=>{n.value||"Enter"!==e.key||e.shiftKey||(e.preventDefault(),O())},ve=o((()=>{let e="请输入您的消息";return n.value||(e+=`，${s.submitKey} 发送，${s.submitKey===W.Enter?W.ShiftEnter:W.Enter} 换行`),e}));return(e,l)=>{const s=A,o=M,i=k("icon-copy"),x=$,f=V,h=k("icon-sync"),b=K,F=Q,I=ee,J=k("icon-close-circle-fill"),U=q,W=z,G=k("icon-record-stop"),P=B,ae=L,pe=w("date-time");return c(),_(ae,{class:"flex flex-col flex-1 overflow-hidden"},{default:C((()=>{var e;return[E("main",se,[R(U,{ref_key:"scrollbarRef",ref:Y,onScroll:X,"outer-style":"flex: 1; overflow: hidden; ",class:"overflow-y-auto h-full p-4 flex flex-col gap-y-2 pb-20"},{default:C((()=>{var e,l,k,w;return[(null==(l=null==(e=g(t))?void 0:e.messages)?void 0:l.length)?T("",!0):(c(),u("div",te,ne)),(c(!0),u(d,null,S(null!=(w=null==(k=g(t))?void 0:k.messages)?w:[],((e,l)=>(c(),u("section",{key:e.id,class:m(["message-item",["assistant"===e.role?"is-reply":"is-request",g(n)?"max-w-full":"max-w-4/5"]])},[E("div",{class:m(["flex items-center gap-x-4",{"flex-row-reverse":"assistant"!==e.role}])},["assistant"===e.role?(c(),_(o,{key:0,loading:e.streaming},{default:C((()=>[R(s,{size:32,class:m("assistant"===e.role?"bg-primary p-2":"bg-success")},{default:C((()=>{var l;return[E("img",{src:null!=(l=D[e.role])?l:""},null,8,oe)]})),_:2},1032,["class"])])),_:2},1032,["loading"])):T("",!0),j((c(),u("small",re,[v(p(e.date),1)])),[[pe,e.date]])],2),e.streaming&&"assistant"===e.role?(c(),u("small",ie," 正在输入... ")):T("",!0),E("section",{class:m(["message-item__content",{"is-user":"user"===e.role,"is-error":e.isError},{"is-assistant":"assistant"===e.role}])},["assistant"!==e.role||(null==e?void 0:e.streaming)?T("",!0):(c(),u("div",ce,[R(f,{"content-class":"text-xs",content:"复制",position:"top"},{default:C((()=>[R(x,{onClick:l=>(le({text:e.content}),y.clear(),void y.success("复制成功")),size:"mini",shape:"circle",type:"text"},{default:C((()=>[R(i,{class:"text-base"})])),_:2},1032,["onClick"])])),_:2},1024),R(f,{"content-class":"text-xs",content:"重试",position:"top"},{default:C((()=>[R(x,{onClick:e=>(e=>{r.value=!1,a.messageRetryAction(e,(()=>{var e,l,a,s;r.value||null==(s=Y.value)||s.scrollTop((null!=(a=null==(l=null==(e=Y.value)?void 0:e.containerRef)?void 0:l.scrollHeight)?a:0)-200)}))})(l),size:"mini",shape:"circle",type:"text"},{default:C((()=>[R(h,{class:"text-base"})])),_:2},1032,["onClick"])])),_:2},1024)])),(null==e?void 0:e.streaming)&&!e.content?(c(),_(F,{key:1,animation:"",class:"rounded overflow-hidden"},{default:C((()=>[R(b)])),_:1})):(c(),u(d,{key:2},[e.isError?(c(),u("div",ue,[R(J),v(" "+p(e.content),1)])):(c(),_(I,{key:e.content,text:e.content,inversion:"assistant"!==e.role},null,8,["text","inversion"]))],64))],2)],2)))),128))]})),_:1},512),R(W,{class:"m-0"}),(null==(e=g(t))?void 0:e.id)?(c(),u("footer",de,[g(a).fetching?(c(),_(x,{key:0,onClick:l[0]||(l[0]=e=>{var l;return null==(l=g(a).abortController)?void 0:l.abort()}),shape:"round",status:"danger",class:"stop-receiving"},{default:C((()=>[R(G,{class:"text-lg mr-2"}),v(" 停止 ")])),_:1})):T("",!0),R(P,{readonly:g(a).fetching,modelValue:g(N),"onUpdate:modelValue":l[1]||(l[1]=e=>H(N)?N.value=e:null),onKeypress:Z,class:"bg-white dark:bg-dark-900 border-none","auto-size":{minRows:g(n)?1:3,maxRows:6},placeholder:g(ve)},null,8,["readonly","modelValue","auto-size","placeholder"]),g(n)&&g(N).trim().length>0?(c(),_(x,{key:1,size:"medium",class:"rounded text-xs",onClick:O,type:"primary"},{default:C((()=>[v(" 发送 ")])),_:1})):T("",!0)])):T("",!0)])]})),_:1})}}});export{ve as default};
