import{c as e,r as a,aj as l,ak as t,al as s,am as n,m as o,ap as r,aq as i,e as c,p as u,u as d,t as v,J as p,o as m,l as g,b as f,w as y,a as x,n as h,ar as b,f as k,g as w,h as _,i as C,H as E,F as R,j as T,v as S,k as H,B as $,W as q,Q as z,as as B,at as L,au as j,av as A,aw as M,S as K,y as V,ax as D,ay as F}from"./.pnpm-40c6151e.js";import{a as I,u as J,b as Q,c as U,d as W,S as Y}from"./index-745705c1.js";const G={key:0,class:"dark:text-white w-[4px] h-[20px] block animate-blink"},N={key:0},O=["innerHTML"],P=["textContent"],X=["textContent"],Z=I(e({__name:"MessageContent",props:{inversion:{type:Boolean},error:{type:Boolean},text:null,loading:{type:Boolean},asRawText:{type:Boolean}},setup(e){const m=e,g=a(),f=new l({linkify:!0,highlight(e,a){if(!(!a||!t.getLanguage(a))){const l=null!=a?a:"";return h(t.highlight(e,{language:l}).value,l)}return h(t.highlightAuto(e).value,"")}});f.use(s,{attrs:{target:"_blank",rel:"noopener"}}),f.use(n,{blockClass:"katexmath-block rounded-md p-[10px]"});const y=o((()=>["message-content","min-w-[20px]","rounded-md",m.inversion?"text-[#f1f1f1]":"bg-[#e5e6eb]",m.inversion?"":"dark:bg-[#1e1e20]",m.inversion?"message-request":"message-reply",{"is-error":m.error}])),x=o((()=>{var e;const a=(null!=(e=m.text)?e:"").replace(/\n+$/g,"");return m.asRawText||m.inversion?a:f.render(a)}));function h(e,a){return`<pre class="code-block-wrapper"><div class="code-block-header"><span class="code-block-header__lang">${a}</span><span class="code-block-header__copy">复制代码</span></div><code class="hljs code-block-body ${a}">${e}</code></pre>`}return r((()=>{i((()=>{g.value&&t.highlightBlock(g.value)}))})),(a,l)=>(c(),u("div",{class:p(d(y))},[e.loading?(c(),u("span",G)):(c(),u("div",{key:1,ref_key:"textRef",ref:g,class:"leading-relaxed break-words"},[e.inversion?(c(),u("div",{key:1,class:"whitespace-pre-wrap",textContent:v(e.text)},null,8,X)):(c(),u("div",N,[e.asRawText?(c(),u("div",{key:1,class:"whitespace-pre-wrap",textContent:v(e.text)},null,8,P)):(c(),u("div",{key:0,class:"markdown-body",innerHTML:d(x)},null,8,O))]))],512))],2))}}),[["__scopeId","data-v-d18d22ba"]]);function ee(e){const a={origin:!0,...e};let l;l=a.origin?document.createElement("textarea"):document.createElement("input"),l.setAttribute("readonly","readonly"),l.value=a.text,document.body.appendChild(l),l.select(),document.execCommand("copy")&&document.execCommand("copy"),document.body.removeChild(l)}function ae(){function e(){document.querySelectorAll(".code-block-wrapper").forEach((e=>{const a=e.querySelector(".code-block-header__copy"),l=e.querySelector(".code-block-body");a&&l&&a.addEventListener("click",(()=>{var e,a,t;(null==(e=navigator.clipboard)?void 0:e.writeText)?(navigator.clipboard.writeText(null!=(a=l.textContent)?a:""),g.clear(),g.success("复制成功")):(ee({text:null!=(t=l.textContent)?t:"",origin:!0}),g.clear(),g.success("复制成功"))}))}))}e(),m((()=>e())),r((()=>e()))}const le={class:"chat-wrapper"},te=["src"],se={class:"date-time"},ne={key:0,class:"text-info"},oe={key:0,class:"message-item__actions"},re={key:0,class:"chat-footer"},ie=e({__name:"ChatView",setup(e){ae();const l=J(),t=Q(),s=o((()=>l.session)),{isMobileScreen:n}=U(),r=a(!1),I={user:W,assistant:"/static/svg/openai-white-1b79b841.svg"},G=a(),N=a("新的聊天");f((()=>{var e;N.value=(null==(e=l.session)?void 0:e.topic)||"新的聊天"})),y((()=>l.currentChat),(()=>{i((()=>{var e,a,l,t;null==(t=G.value)||t.scrollTop((null!=(l=null==(a=null==(e=G.value)?void 0:e.containerRef)?void 0:a.scrollHeight)?l:0)-200)}))}));const O=a(""),P=()=>{if(e=O.value,/^[\s\n\r]*$/.test(e))return g.clear(),void g.error("请输入消息内容");var e;r.value=!1,l.sendMessageAction(O.value,(e=>{var a,l,t,s;r.value||null==(s=G.value)||s.scrollTop((null!=(t=null==(l=null==(a=G.value)?void 0:a.containerRef)?void 0:l.scrollHeight)?t:0)-200),e&&i((()=>{ae()}))})),O.value=""},X=e=>{e.deltaY<10&&(r.value=!0)};m((()=>{i((()=>{var e,a,l,t,s;null==(t=G.value)||t.scrollTop((null!=(l=null==(a=null==(e=G.value)?void 0:e.containerRef)?void 0:a.scrollHeight)?l:0)-200),null==(s=G.value)||s.$el.querySelector(".arco-scrollbar-container").addEventListener("wheel",X)}))}));const ie=e=>{var a,l,t;((null==(a=null==e?void 0:e.target)?void 0:a.scrollTop)||0)+((null==(l=null==e?void 0:e.target)?void 0:l.offsetHeight)||0)>=((null==(t=null==e?void 0:e.target)?void 0:t.scrollHeight)||0)-70&&(r.value=!1)};x((()=>{var e,a,t;(null==(e=l.abortController)?void 0:e.abort)&&(null==(a=l.abortController)||a.abort()),null==(t=G.value)||t.$el.querySelector(".arco-scrollbar-container").removeEventListener("wheel",X)}));const ce=e=>{n.value||"Enter"!==e.key||e.shiftKey||(e.preventDefault(),P())},ue=o((()=>{let e="请输入您的消息";return n.value||(e+=`，${t.submitKey} 发送，${t.submitKey===Y.Enter?Y.ShiftEnter:Y.Enter} 换行`),e}));return(e,a)=>{const t=M,o=K,i=h("icon-copy"),m=$,f=V,y=h("icon-sync"),x=D,J=F,Q=Z,U=q,W=z,Y=h("icon-record-stop"),N=B,X=L,ae=b("date-time");return c(),k(X,{class:"flex flex-col flex-1 overflow-hidden"},{default:w((()=>{var e;return[_("main",le,[C(U,{ref_key:"scrollbarRef",ref:G,onScroll:ie,"outer-style":"flex: 1; overflow: hidden; ",class:"overflow-y-auto h-full p-4 flex flex-col gap-y-2 pb-20"},{default:w((()=>{var e,a;return[(c(!0),u(R,null,E(null!=(a=null==(e=d(s))?void 0:e.messages)?a:[],((e,a)=>(c(),u("section",{key:e.id,class:p(["message-item",["assistant"===e.role?"is-reply":"is-request",d(n)?"max-w-full":"max-w-4/5"]])},[_("div",{class:p(["flex items-center gap-x-4",{"flex-row-reverse":"assistant"!==e.role}])},["assistant"===e.role?(c(),k(o,{key:0,loading:e.streaming},{default:w((()=>[C(t,{size:32,class:p("assistant"===e.role?"bg-primary p-2":"bg-success")},{default:w((()=>{var a;return[_("img",{src:null!=(a=I[e.role])?a:""},null,8,te)]})),_:2},1032,["class"])])),_:2},1032,["loading"])):S("",!0),j((c(),u("small",se,[T(v(e.date),1)])),[[ae,e.date]])],2),e.streaming&&"assistant"===e.role?(c(),u("small",ne," 正在输入... ")):S("",!0),_("section",{class:p(["message-item__content",{"is-user":"user"===e.role,"is-error":e.isError},{"is-assistant":"assistant"===e.role}])},["assistant"!==e.role||(null==e?void 0:e.streaming)?S("",!0):(c(),u("div",oe,[C(f,{"content-class":"text-xs",content:"复制",position:"top"},{default:w((()=>[C(m,{onClick:a=>(ee({text:e.content}),g.clear(),void g.success("复制成功")),size:"mini",shape:"circle",type:"text"},{default:w((()=>[C(i,{class:"text-base"})])),_:2},1032,["onClick"])])),_:2},1024),C(f,{"content-class":"text-xs",content:"重试",position:"top"},{default:w((()=>[C(m,{onClick:e=>(e=>{r.value=!1,l.messageRetryAction(e,(()=>{var e,a,l,t;r.value||null==(t=G.value)||t.scrollTop((null!=(l=null==(a=null==(e=G.value)?void 0:e.containerRef)?void 0:a.scrollHeight)?l:0)-200)}))})(a),size:"mini",shape:"circle",type:"text"},{default:w((()=>[C(y,{class:"text-base"})])),_:2},1032,["onClick"])])),_:2},1024)])),(null==e?void 0:e.streaming)&&!e.content?(c(),k(J,{key:1,animation:"",class:"rounded overflow-hidden"},{default:w((()=>[C(x)])),_:1})):(c(),k(Q,{key:e.content,text:d(A)(e.content)?e.content:"",error:e.isError,inversion:"assistant"!==e.role},null,8,["text","error","inversion"]))],2)],2)))),128))]})),_:1},512),C(W,{class:"m-0"}),(null==(e=d(s))?void 0:e.id)?(c(),u("footer",re,[d(l).fetching?(c(),k(m,{key:0,onClick:a[0]||(a[0]=e=>{var a;return null==(a=d(l).abortController)?void 0:a.abort()}),shape:"round",status:"danger",class:"stop-receiving"},{default:w((()=>[C(Y,{class:"text-lg mr-2"}),T(" 停止 ")])),_:1})):S("",!0),C(N,{readonly:d(l).fetching,modelValue:d(O),"onUpdate:modelValue":a[1]||(a[1]=e=>H(O)?O.value=e:null),onKeypress:ce,class:"bg-white dark:bg-dark-900 border-none","auto-size":{minRows:d(n)?1:3,maxRows:6},placeholder:d(ue)},null,8,["readonly","modelValue","auto-size","placeholder"]),d(n)&&d(O).trim().length>0?(c(),k(m,{key:1,size:"medium",class:"rounded text-xs",onClick:P,type:"primary"},{default:w((()=>[T(" 发送 ")])),_:1})):S("",!0)])):S("",!0)])]})),_:1})}}});export{ie as default};
