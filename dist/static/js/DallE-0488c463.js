import{o as a,ay as e,d as l,r as s,l as t,c as o,az as n,m as r,aA as d,n as u,as as i,e as c,f as m,g as p,h as f,i as g,j as x,p as b,G as w,u as v,F as y,H as _,v as h,aB as k,aC as E,J as V,B as z,aD as S,R as j,a0 as A,a3 as C,aE as D,aF as T,aG as U,U as I,t as O,av as J,aH as L,M as R,x as $,aI as B,aJ as F,aK as G,aL as H}from"./.pnpm-9b9cce88.js";import{d as M,I as P,e as K,D as N,a as W}from"./index-e9e3322f.js";const q=l("__AI_1024_STORE_DRAW",(()=>{const e=M(),l=s(!1),o=s([]);a((()=>{}));return{draws:o,loading:l,imageDrawAction:a=>{l.value=!0,async function(a,e){const l=new AbortController,s=setTimeout((()=>l.abort()),3e5);try{const t=`${M().bootstrap.api}${P}`,o=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),signal:l.signal});if(clearTimeout(s),o.ok){const a=await o.json();500===a.code?null==e||e.onError(new Error(a.msg),a.code):null==e||e.onSuccess(a)}else if(401===o.status)null==e||e.onError(new Error("Anauthorized"),o.status);else if(500===o.status){const a=await o.json();null==e||e.onError(new Error(a),o.status)}else null==e||e.onError(new Error("Stream Error"),o.status)}catch(t){null==e||e.onError(t)}}({...a,card:e.card},{onController(a){},onSuccess(e){l.value=!1,o.value.push({prompt:a.prompt,size:a.size,urls:e.data.map((a=>`data:image/png;base64, ${a.b64_json}`)),date:e.created})},onError(a){var e;l.value=!1,t.error(null!=(e=null==a?void 0:a.message)?e:"")}})}}}),{persist:{storage:localStorage,paths:["draws"]}}),Q={class:"flex items-center gap-x-5"},X={class:"text-xs px-2 py-1"},Y={class:"flex flex-col gap-y-1 select-none"},Z=W(o({__name:"DallE",setup(l){const{isMobileScreen:o}=K(),M=n({prompt:"",size:"256x256",n:1,response_format:"b64_json"}),P=s(0),W=r((()=>k(N,2)[P.value])),Z=()=>{const a=k(N,2).length-1,e=P.value+1>a?0:P.value+1;P.value=e},aa=q(),ea=r((()=>aa.loading));(l=>{const s=a=>{l&&(a.returnValue="浏览器正在关闭或刷新页面！")};a((()=>{window.addEventListener("beforeunload",s)})),e((()=>{window.removeEventListener("beforeunload",s)}))})(ea),d((async()=>!ea.value||await new Promise(((a,e)=>{R.warning({title:"提示",okText:"离开",hideCancel:!1,content:"AI已经开始处理您的请求，此时刷新或离开页面，也会造成您的积分扣除，确定刷新或离开吗？",onOk(){a(!0)},onCancel(){e(!1)}})}))));const la=()=>{M.prompt.trim().length<1?t.error("关键词不能为空"):aa.imageDrawAction(M)},sa=r((()=>aa.draws));return(a,e)=>{const l=u("icon-exclamation-circle-fill"),s=E,t=V,n=u("icon-loop"),r=z,d=$,k=u("icon-robot"),R=S,P=j,K=A,N=C,q=B,aa=F,ta=G,oa=H,na=D,ra=T,da=U,ua=I,ia=i("date-time");return c(),m(ua,{"outer-style":"flex: 1; overflow: hidden;",class:"overflow-y-auto h-full p-4 flex flex-col gap-y-2"},{default:p((()=>[f("div",{class:_(["draw-view",{"is-mobile":v(o)}])},[g(s,{type:"info",class:"max-w-max mx-auto rounded-full text-xs"},{icon:p((()=>[g(l)])),default:p((()=>[x(" 根据输入关键词生成~大约需要30s左右时间 ")])),_:1}),f("div",Q,[g(t,{class:"h-12 flex items-center",bold:""},{default:p((()=>[x(" 关键词示例 ")])),_:1}),g(r,{type:"text",size:"mini",onClick:Z},{default:p((()=>[g(n)])),_:1})]),(c(!0),b(y,null,w(v(W),(a=>(c(),b("div",{key:a.tag,class:"flex items-center gap-x-1 mb-2"},[f("mark",X,O(a.tag),1),g(d,{type:"secondary",copyable:"",class:"mb-0"},{default:p((()=>[x(O(a.keywords),1)])),_:2},1024)])))),128)),g(R,{loading:v(ea),class:"w-full mt-4",size:"large",autofocus:"",modelValue:v(M).prompt,"onUpdate:modelValue":e[0]||(e[0]=a=>v(M).prompt=a),placeholder:"请用中文输入关键词如上，参考形式: 画面主体，细节描述，修饰词","search-button":"",onSearch:la},{"button-icon":p((()=>[g(k)])),"button-default":p((()=>[x("生成")])),_:1},8,["loading","modelValue"]),g(N,{model:v(M),class:_([{"is-mobile":v(o)},"mt-4 p-4 bg-light-300 dark:bg-dark-900 rounded"]),"label-col-props":{span:v(o)?24:void 0},"auto-label-width":!v(o),"label-align":"left"},{default:p((()=>[g(t,{class:"block",bold:""},{default:p((()=>[x(" 参数设置 ")])),_:1}),g(K,{label:"图片尺寸",class:"mb-2"},{default:p((()=>[f("div",{class:_(["w-full",{"grid grid-cols-2 gap-y-2":v(o)}])},[g(P,{class:"min-w-max",modelValue:v(M).size,"onUpdate:modelValue":e[1]||(e[1]=a=>v(M).size=a),type:"button",value:"256x256"},{default:p((()=>[x(" 256x256(小图) ")])),_:1},8,["modelValue"]),g(P,{class:"min-w-max",modelValue:v(M).size,"onUpdate:modelValue":e[2]||(e[2]=a=>v(M).size=a),type:"button",value:"512x512"},{default:p((()=>[x(" 512x512(中图) ")])),_:1},8,["modelValue"]),g(P,{class:"min-w-max",modelValue:v(M).size,"onUpdate:modelValue":e[3]||(e[3]=a=>v(M).size=a),type:"button",value:"1024x1024"},{default:p((()=>[x(" 1024x1024(大图) ")])),_:1},8,["modelValue"])],2)])),_:1}),g(K,{help:"每张图片 20 积分","validate-status":"warning",label:"图片数量",class:"mb-2"},{default:p((()=>[f("div",{class:_(["w-full",{"grid grid-cols-5 gap-y-2":v(o)}])},[(c(),b(y,null,w(10,(a=>g(P,{class:"min-w-max",modelValue:v(M).n,"onUpdate:modelValue":e[4]||(e[4]=a=>v(M).n=a),type:"button",key:a,value:a},{default:p((()=>[x(O(a)+"张 ",1)])),_:2},1032,["modelValue","value"]))),64))],2)])),_:1})])),_:1},8,["model","class","label-col-props","auto-label-width"]),v(sa).length?(c(),m(da,{key:0,class:"mt-6",type:"capsule"},{default:p((()=>[g(ra,{key:"1",title:"我的作品"},{default:p((()=>[g(na,{"default-active-key":[1],accordion:""},{default:p((()=>[(c(!0),b(y,null,w(v(sa).reverse(),(a=>(c(),m(oa,{key:a.date},{extra:p((()=>[g(q,{color:"red",size:"small"},{default:p((()=>[x(O(a.urls.length)+"张",1)])),_:2},1024)])),header:p((()=>[f("div",Y,[g(d,{class:"mb-0",ellipsis:{rows:1,expandable:!0}},{default:p((()=>[x(O(a.prompt),1)])),_:2},1024),J(f("small",{style:L({color:"var(--color-text-3)"})},null,4),[[ia,1e3*a.date]])])])),default:p((()=>[g(ta,{infinite:""},{default:p((()=>[f("div",{class:_(["grid gap-3",[v(o)?"grid-cols-2":"grid-cols-5"]])},[(c(!0),b(y,null,w(a.urls,(a=>(c(),m(aa,{key:a,src:a},null,8,["src"])))),128))],2)])),_:2},1024),g(s,{type:"info",class:"max-w-max mx-auto rounded-full text-xs my-4"},{icon:p((()=>[g(l)])),default:p((()=>[x(" 尺寸: "+O(a.size),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})):h("",!0)],2)])),_:1})}}}),[["__scopeId","data-v-ccad8f75"]]);export{Z as default};
